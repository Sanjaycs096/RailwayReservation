<!doctype html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard - RailConnect</title>
<link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
<header class="header"><div class="header-container container"><div class="logo"><h1><i class="fas fa-train"></i> RailConnect Admin</h1></div>
<button id="logoutBtn" class="btn btn-danger" style="float:right;margin-top:10px;">Logout</button>
</div></header>
<main style="padding:100px 20px;">
<div class="container" style="max-width:900px;background:#fff;padding:20px;border-radius:8px;">
<h2>Admin Dashboard (Demo)</h2>
<p>This is a simple demo admin page. It does not authenticate server-side.</p>
<form id="addTrainForm">
<div class="form-group"><label for="trainName">Train Name</label><input id="trainName" placeholder="Express 123"/></div>
<div class="form-group"><label for="fromStation">From</label><input id="fromStation"/></div>
<div class="form-group"><label for="toStation">To</label><input id="toStation"/></div>
<div class="form-group"><label for="departureTime">Departure Time</label><input id="departureTime" type="time"/></div>
<div class="form-group"><label for="arrivalTime">Arrival Time</label><input id="arrivalTime" type="time"/></div>
<div class="form-group"><label for="totalSeats">Total Seats</label><input id="totalSeats" type="number" min="1" value="100"/></div>
<button class="btn btn-primary">Add Train</button>
</form>
<div id="trainMsg" style="color:green;font-weight:500;margin:10px 0 20px 0;display:none;">Train added!</div>

<h3>All Trains</h3>
<table id="trainsTable" border="1" style="width:100%;margin-bottom:30px;"><thead><tr><th>Name</th><th>From</th><th>To</th><th>Departure</th><th>Arrival</th><th>Total Seats</th></tr></thead><tbody></tbody></table>

<h3>All Bookings (Demo)</h3>
<table id="bookingsTable" border="1" style="width:100%;"><thead><tr><th>User ID</th><th>Train</th><th>Seats</th><th>Date</th><th>Status</th></tr></thead><tbody></tbody></table>
</div>
</main>
<script>
// Simple client-side guard: redirect to login if not admin
if(sessionStorage.getItem('role')!=='admin'){
    alert('Please login as admin to view this page (demo).');
    window.location.href = '/login.html';
}
// Logout button
document.getElementById('logoutBtn').onclick = function(){
    sessionStorage.clear();
    window.location.href = '/login.html';
};
// Add train logic (MongoDB backend)
const trainForm = document.getElementById('addTrainForm');
const trainMsg = document.getElementById('trainMsg');
const trainsTable = document.getElementById('trainsTable').querySelector('tbody');
const bookingsTable = document.getElementById('bookingsTable').querySelector('tbody');

async function fetchTrains(){
    const res = await fetch('/api/trains');
    const data = await res.json();
    return data.trains || [];
}
async function renderTrains(){
    const trains = await fetchTrains();
    trainsTable.innerHTML = trains.length ? trains.map(t=>`<tr><td>${t.name}</td><td>${t.source||t.from}</td><td>${t.destination||t.to}</td><td>${t.departure_time||t.departure}</td><td>${t.arrival_time||'-'}</td><td>${t.total_seats||'-'}</td></tr>`).join('') : '<tr><td colspan="6">No trains added</td></tr>';
}
async function fetchBookings(){
    // For demo, fetch all bookings (requires backend endpoint for all bookings, else show none)
    const res = await fetch('/api/bookings/all').catch(()=>null);
    if(!res||!res.ok) { bookingsTable.innerHTML = '<tr><td colspan="5">No bookings</td></tr>'; return; }
    const data = await res.json();
    const bookings = data.bookings || [];
    bookingsTable.innerHTML = bookings.length ? bookings.map(b=>`<tr><td>${b.user_id||'-'}</td><td>${b.train_name||'-'}</td><td>${b.seats||'-'}</td><td>${b.date||'-'}</td><td>${b.status||'-'}</td></tr>`).join('') : '<tr><td colspan="5">No bookings</td></tr>';
}
trainForm.onsubmit = async function(e){
    e.preventDefault();
    const name = document.getElementById('trainName').value.trim();
    const source = document.getElementById('fromStation').value.trim();
    const destination = document.getElementById('toStation').value.trim();
    const departure_time = document.getElementById('departureTime').value.trim();
    const arrival_time = document.getElementById('arrivalTime').value.trim();
    const total_seats = parseInt(document.getElementById('totalSeats').value,10)||100;
    if(!name||!source||!destination||!departure_time||!arrival_time||!total_seats){alert('Fill all fields');return;}
    const res = await fetch('/api/admin/trains',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name,source,destination,departure_time,arrival_time,total_seats})
    });
    if(res.ok){
        trainMsg.style.display='block';
        setTimeout(()=>{trainMsg.style.display='none';},2000);
        trainForm.reset();
        renderTrains();
    }else{
        alert('Failed to add train');
    }
};
renderTrains();
fetchBookings();
</script>
</body></html>