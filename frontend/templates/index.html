<!-- Seat Selection Modal -->
    <div id="seatSelectionModal" class="modal">
        <div class="modal-content" style="max-width:700px;">
            <span class="close" onclick="this.closest('.modal').style.display='none'">&times;</span>
            <div class="modal-header">
                <h2>Select Coach & Seats</h2>
            </div>
            <div class="modal-body">
                <div class="train-info"></div>
                <div class="coach-select" style="margin:16px 0;">
                    <label for="coachList">Choose Coach/Class:</label>
                    <select id="coachList" style="margin-left:8px;"></select>
                </div>
                <div class="seat-map" style="display:flex;flex-wrap:wrap;gap:6px 10px;margin-bottom:16px;"></div>
                <div class="seat-list" style="margin-bottom:8px;"></div>
                <div class="seat-summary" style="margin-bottom:8px;">
                    <span class="total-price">â‚¹0</span>
                </div>
                <button class="btn btn-primary proceed-payment">Proceed to Payment</button>
            </div>
        </div>
    </div>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Reservation & Tracking Platform</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/animations.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="../static/css/intlTelInput.min.css" rel="stylesheet">
    <link href="../static/css/map.css" rel="stylesheet">
    <style>
        /* Train Tracking Styles */
        .tracking-results {
            margin-top: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .train-info {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .train-info h3 {
            margin-top: 0;
            color: #333;
            font-size: 22px;
        }
        .train-status {
            margin: 15px 0;
        }
        .status-label {
            font-weight: bold;
            margin-right: 10px;
        }
        .status-value {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .status-value.running {
            background-color: #e3f7e8;
            color: #28a745;
        }
        .status-value.delayed {
            background-color: #fff3cd;
            color: #ffc107;
        }
        .status-value.arrived {
            background-color: #cce5ff;
            color: #007bff;
        }
        .train-details-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .detail-item {
            flex: 1;
            min-width: 120px;
            padding: 10px;
        }
        .detail-label {
            display: block;
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .detail-value {
            font-weight: 500;
            color: #333;
        }
        .route-visualization {
            padding: 20px;
        }
        .route-visualization h4 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
        }
        .route-map {
            position: relative;
            padding: 10px 0;
        }
        .route-stations {
            position: relative;
        }
        .route-stations:before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 15px;
            width: 4px;
            background-color: #e9ecef;
            z-index: 1;
        }
        .station {
            position: relative;
            padding-left: 50px;
            margin-bottom: 30px;
            z-index: 2;
        }
        .station:last-child {
            margin-bottom: 0;
        }
        .station-dot {
            position: absolute;
            left: 0;
            top: 0;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background-color: white;
            border: 4px solid #e9ecef;
            z-index: 3;
        }
        .station.completed .station-dot {
            background-color: #28a745;
            border-color: #c3e6cb;
        }
        .station.current .station-dot {
            background-color: #007bff;
            border-color: #b8daff;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.25);
        }
        .station-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        .station-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        .station-time {
            font-size: 13px;
            color: #666;
        }
        .station.completed .station-info {
            background-color: #f0f9f2;
        }
        .station.current .station-info {
            background-color: #e8f4ff;
            border-left: 3px solid #007bff;
        }
        
        /* Seat selection styles */
        .coach-layout {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .seat-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .seat {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }
        
        .seat.available {
            background-color: #e0f7fa;
            border: 1px solid #4fc3f7;
        }
        
        .seat.booked {
            background-color: #ffebee;
            border: 1px solid #ef9a9a;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .seat.selected {
            background-color: #c8e6c9;
            border: 2px solid #66bb6a;
        }
        
        .seat-number {
            font-size: 12px;
            font-weight: bold;
        }
        
        .seat-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .seat-sample {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .seat-sample.available {
            background-color: #e0f7fa;
            border: 1px solid #4fc3f7;
        }
        
        .seat-sample.booked {
            background-color: #ffebee;
            border: 1px solid #ef9a9a;
        }
        
        .seat-sample.selected {
            background-color: #c8e6c9;
            border: 2px solid #66bb6a;
        }
        
        .seat-actions {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .loading-seats {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .train-details {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        /* Responsive styles for mobile devices */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                padding: 10px;
            }
            .nav-links {
                flex-direction: column;
                width: 100%;
                display: none;
            }
            .nav-links.active {
                display: flex;
            }
            .mobile-menu-btn {
                display: block;
            }
            .hero-content {
                padding: 40px 20px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
            .booking-container, .tracking-container {
                flex-direction: column;
            }
            .search-form, .tracking-form, .train-results {
                width: 100%;
                margin-bottom: 20px;
            }
            .train-item {
                flex-direction: column;
            }
            .train-info, .train-classes {
                width: 100%;
            }
            .train-classes {
                margin-top: 15px;
            }
            .book-btn {
                width: 100%;
                margin-top: 15px;
            }
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 15px;
            }
            .seat-map {
                justify-content: center;
            }
            .train-details-row {
                flex-direction: column;
            }
            .detail-item {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="header-container container">
            <div class="logo">
                <h1><i class="fas fa-train"></i> RailConnect</h1>
            </div>
            <ul class="nav-links">
                <li><a href="/" class="active">Home</a></li>
                <li><a href="#booking">Book Tickets</a></li>
                <li><a href="#tracking">Track Train</a></li>
                <li><a href="#alerts">Alerts</a></li>
                <li><a href="/login.html">Login</a></li>
            </ul>
            <button class="mobile-menu-btn" aria-label="Open navigation menu"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content" style="max-width: 100vw;">
                <h2>Book Your Journey with Confidence</h2>
                <p>Real-time tracking, instant alerts, and seamless booking experience</p>
                <div class="hero-buttons">
                    <a href="#booking" class="btn btn-primary">Book Now</a>
                    <a href="#tracking" class="btn btn-secondary">Track Train</a>
                </div>
            </div>

                                    <circle cx="200" cy="20" r="1" fill="#fff" />
                                    <circle cx="280" cy="15" r="1" fill="#fff" />
                                    <circle cx="330" cy="25" r="1" fill="#fff" />
                                    <path d="M300,20 a15,15 0 0,1 20,0 a15,15 0 0,1 -20,0" fill="#f1c40f" />
                                </svg>
                        </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">Our Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <h3>Easy Booking</h3>
                    <p>Book tickets and select seats with just a few clicks</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h3>Real-time Tracking</h3>
                    <p>Track your train's location in real-time</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <h3>Instant Alerts</h3>
                    <p>Get notified about delays, platform changes, and more</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <h3>Secure Payments</h3>
                    <p>Pay securely with multiple payment options</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Booking Section -->
    <section id="booking" class="booking">
    <div class="container" style="max-width: 900px;">
        <div id="coach-position-info" style="margin-bottom:12px;font-size:15px;color:#2d6a4f;"></div>
            <h2 class="section-title">Book Your Tickets</h2>
            <div class="booking-container">
                <div class="search-form">
                    <form id="trainSearchForm">
                        <div class="form-group">
                            <label for="source">From</label>
                            <input type="text" id="source" placeholder="Enter source station">
                        </div>
                        <div class="form-group">
                            <label for="destination">To</label>
                            <input type="text" id="destination" placeholder="Enter destination station">
                        </div>
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" id="date">
                        </div>
                        <div class="form-group">
                            <label>Entered Data:</label>
                            <div id="enteredData" style="background:#f5f7fa;padding:8px 12px;border-radius:5px;font-size:14px;color:#333;">
                                From: <span id="enteredSource">-</span><br>
                                To: <span id="enteredDestination">-</span><br>
                                Date: <span id="enteredDate">-</span>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Search Trains</button>
                    </form>
                </div>
                <div class="train-results">
                    <h3>Available Trains</h3>
                    <div id="trainList" class="train-list">
                        <!-- Train results will be displayed here -->
                        <div class="no-trains">Search for trains to see results</div>
                        <!-- Sample train results for demo -->
                        <div class="train-item" style="display:none;" id="sampleTrainResults">
                            <div class="train-info">
                                <h4>Rajdhani Express (12301)</h4>
                                <div class="train-details">
                                    <div class="train-route">
                                        <span class="source">Delhi</span>
                                        <span class="journey-line">â†’</span>
                                        <span class="destination">Mumbai</span>
                                    </div>
                                    <div class="train-time">
                                        <span class="departure">07:00</span>
                                        <span class="duration">14h 30m</span>
                                        <span class="arrival">21:30</span>
                                    </div>
                                </div>
                            </div>
                            <div class="train-classes">
                                <div class="class-item">
                                    <span class="class-name">Sleeper (SL)</span>
                                    <span class="class-price">â‚¹750</span>
                                    <span class="class-availability">Available</span>
                                </div>
                                <div class="class-item">
                                    <span class="class-name">AC 3 Tier (3A)</span>
                                    <span class="class-price">â‚¹1,500</span>
                                    <span class="class-availability">Available</span>
                                </div>
                                <div class="class-item">
                                    <span class="class-name">AC 2 Tier (2A)</span>
                                    <span class="class-price">â‚¹2,200</span>
                                    <span class="class-availability">Available</span>
                                </div>
                            </div>
                            <button class="btn btn-primary book-btn" data-train-id="12301">Book Now</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tracking Section -->
    <section id="tracking" class="tracking">
    <div class="container" style="max-width: 900px;">
            <h2 class="section-title">Track Your Train</h2>
            <div class="tracking-container">
                <div class="tracking-form">
                    <form id="trackingForm">
                        <div class="form-group">
                            <label for="trainNumber">Train Number or Name</label>
                            <input type="text" id="trainNumber" placeholder="Enter train number or name">
                        </div>
                        <button type="submit" class="btn btn-primary">Track Now</button>
                    </form>
                </div>
                
                <div id="trackingResults" class="tracking-results" style="display: none;">
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                    <div class="train-info">
                        <h3 id="trackTrainName">Rajdhani Express (12301)</h3>
                        <div class="train-status">
                            <span class="status-label">Status:</span>
                            <span class="status-value running">Running</span>
                        </div>
                        <div class="train-details-row">
                            <div class="detail-item">
                                <span class="detail-label">From:</span>
                                <span id="trackFromStation" class="detail-value">Delhi</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">To:</span>
                                <span id="trackToStation" class="detail-value">Mumbai</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Duration:</span>
                                <span id="trackDuration" class="detail-value">14h 30m</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Distance:</span>
                                <span id="trackDistance" class="detail-value">1,384 km</span>
                            </div>
                        </div>
                    </div>
                </div>
                    </form>
                </div>
                <div class="tracking-results">
                    <div id="trackingInfo" class="tracking-info">
                        <!-- Tracking information will be displayed here -->
                        <div class="no-tracking">Enter train number to track</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Alerts Section -->
    <section id="alerts" class="alerts">
    <div class="container" style="max-width: 900px;">
        <div id="route-alert-info" style="margin-bottom:12px;font-size:15px;color:#e74c3c;"></div>
            <h2 class="section-title">Latest Alerts</h2>
            <div class="alerts-container">
                <div id="alertsList" class="alerts-list">
                    <!-- Alerts will be displayed here -->
                    <div class="no-alerts">No alerts at the moment</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
            <span class="close" tabindex="0" aria-label="Close">&times;</span>
            <h2 id="loginTitle">Login</h2>
            <div class="login-tabs">
                <button class="tab-btn active" id="adminTab">Admin</button>
                <button class="tab-btn" id="passengerTab">Passenger</button>
            </div>

            <form id="adminLoginForm" class="login-form">
                <div class="form-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" placeholder="Enter admin email" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary animated-btn">Login as Admin</button>
            </form>
            <form id="passengerLoginForm" class="login-form" style="display:none;">
                <div class="form-group">
                    <label for="passengerPhone">Phone Number</label>
                    <input type="tel" id="passengerPhone" placeholder="Enter phone number" required autocomplete="tel">
                    <div class="error-message" id="phoneError" style="display:none;color:red;font-size:12px;margin-top:4px;"></div>
                </div>
                <div class="form-group otp-group" style="display:none;">
                    <label for="passengerOTP">OTP <small id="otpTimer" style="color:#888;margin-left:8px;">(00:30)</small></label>
                    <input type="text" id="passengerOTP" placeholder="Enter OTP" maxlength="6" pattern="[0-9]*" inputmode="numeric">
                    <div class="error-message" id="otpError" style="display:none;color:red;font-size:12px;margin-top:4px;"></div>
                </div>
                <div style="display:flex;gap:8px;align-items:center;">
                    <button type="button" class="btn btn-primary animated-btn" id="sendOTPBtn">Send OTP</button>
                    <button type="button" class="btn btn-outline" id="resendOTPBtn" style="display:none;">Resend OTP</button>
                    <button type="submit" class="btn btn-primary" id="verifyOTPBtn" style="display:none;">Verify OTP</button>
                </div>
                <div style="margin-top:12px;text-align:right;">
                    <a href="#" id="registerRefLink">Register</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="registerTitle">
            <span class="close" tabindex="0" aria-label="Close">&times;</span>
            <h2 id="registerTitle">Register</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="Enter your full name" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group otp-group" style="display:none;">
                    <label for="registerOTP">OTP <small id="registerOtpTimer" style="color:#888;margin-left:8px;">(00:30)</small></label>
                    <input type="text" id="registerOTP" placeholder="Enter OTP" maxlength="6">
                </div>
                <div style="display:flex;gap:8px;align-items:center;">
                    <button type="button" class="btn btn-primary animated-btn" id="registerSendOTPBtn">Send OTP</button>
                    <button type="button" class="btn btn-outline" id="registerResendOTPBtn" style="display:none;">Resend OTP</button>
                    <button type="button" class="btn btn-primary" id="registerVerifyOTPBtn" style="display:none;">Verify OTP</button>
                </div>
                <div class="form-group" id="registerPasswordGroup" style="display:none;">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Enter your password" required autocomplete="new-password">
                </div>
                <div class="form-group" id="registerConfirmPasswordGroup" style="display:none;">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm your password" required autocomplete="new-password">
                </div>
                <button type="submit" class="btn btn-primary" id="registerSubmitBtn" style="display:none;">Register</button>
            </form>
            <p>Already have an account? <a href="#" id="loginLink">Login</a></p>
        </div>
    </div>

    <!-- Seat Selection Modal -->
    <div id="seatModal" class="modal">
        <div class="modal-content seat-modal-content">
            <span class="close">&times;</span>
            <h2>Select Your Seats</h2>
            <div class="train-details" id="bookingTrainDetails">
                <!-- Train details will be displayed here -->
            </div>
            <div class="coach-selection">
                <label for="coachSelect">Select Coach:</label>
                <select id="coachSelect">
                    <!-- Coach options will be populated dynamically -->
                </select>
            </div>
            <div class="seat-container">
                <!-- Seat map will be displayed here -->
            </div>
                        <div class="form-group">
                            <label for="sourceModal">From</label>
                            <input type="text" id="sourceModal" placeholder="Enter source station" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label for="destinationModal">To</label>
                            <input type="text" id="destinationModal" placeholder="Enter destination station" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label for="dateModal">Date</label>
                            <input type="date" id="dateModal">
                        </div>
                        <div class="form-group">
                            <label>Entered Data:</label>
                            <div id="enteredDataModal" style="background:#f5f7fa;padding:8px 12px;border-radius:5px;font-size:14px;color:#333;">
                                From: <span id="enteredSourceModal">-</span><br>
                                To: <span id="enteredDestinationModal">-</span><br>
                                Date: <span id="enteredDateModal">-</span>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Search Trains</button>
                    </form>
                </div>
                <div class="train-results">
                    <h3>Available Trains</h3>
                    <div id="trainList" class="train-list">
                        <!-- Train results will be displayed here -->
                        <div class="no-trains">Search for trains to see results</div>
                    </div>
                </div>
            </div>
                </div>
        </div>
    </div>

    <!-- Booking Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="confirmation-content">
                <div class="confirmation-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>Booking Confirmed!</h2>
                <p>Your booking has been confirmed. Your booking ID is <span id="bookingId">RAIL123456</span>.</p>
                <div class="booking-details">
                    <h3>Booking Details</h3>
                    <p><strong>Train:</strong> <span id="confirmTrainName">Express 12345</span></p>
                    <p><strong>From:</strong> <span id="confirmSource">Delhi</span></p>
                    <p><strong>To:</strong> <span id="confirmDestination">Mumbai</span></p>
                    <p><strong>Date:</strong> <span id="confirmDate">2023-10-15</span></p>
                    <p><strong>Seats:</strong> <span id="confirmSeats">A1, A2, A3</span></p>
                    <p><strong>Total Amount:</strong> â‚¹<span id="confirmAmount">1500</span></p>
                </div>
                <p>A confirmation email has been sent to your registered email address.</p>
                <button id="downloadTicket" class="btn btn-primary">Download Ticket</button>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2><i class="fas fa-train"></i> RailConnect</h2>
                    <p>Your trusted railway reservation and tracking platform</p>
                </div>
                    <!-- Quick Links removed as requested -->
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-envelope"></i> info@railconnect.com</p>
                    <p><i class="fas fa-phone"></i> +1 (123) 456-7890</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Railway Street, City, Country</p>
                </div>
                <div class="footer-social">
                    <h3>Follow Us</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 RailConnect. All rights reserved.</p>
            </div>
        </div>
    </footer>

        <!-- JavaScript -->
            <script src="../static/js/plugins/intlTelInput.min.js"></script>
            <script src="../static/js/map.js"></script>
            <script src="../static/js/main.js"></script>
            <script>

            // Mobile nav toggle
            const menuBtn = document.querySelector('.mobile-menu-btn');
            const navLinks = document.querySelector('.nav-links');
            menuBtn && menuBtn.addEventListener('click', () => navLinks.classList.toggle('active'));
            
            // Seat Selection Modal functionality
            document.querySelectorAll('.book-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Check if user is logged in
                    const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
                    
                    if (!isLoggedIn) {
                        // Show login modal if not logged in
                        document.getElementById('loginModal').style.display = 'block';
                        // Store the train info to continue booking after login
                        const trainInfo = this.closest('.train-item').dataset;
                        localStorage.setItem('pendingBooking', JSON.stringify(trainInfo));
                        return;
                    }
                    
                    document.getElementById('seatSelectionModal').style.display = 'block';
                    
                    // Populate coach selection
                    const coachList = document.getElementById('coachList');
                    coachList.innerHTML = `
                        <option value="SL">Sleeper (SL) - â‚¹750</option>
                        <option value="3A">AC 3 Tier (3A) - â‚¹1,500</option>
                        <option value="2A">AC 2 Tier (2A) - â‚¹2,200</option>
                    `;
                    
                    // Generate seat map
                    generateSeatMap();
                });
            });
            
            // Generate seat map based on selected coach
            function generateSeatMap() {
                const coachType = document.getElementById('coachList').value || 'SL';
                const seatMap = document.querySelector('.seat-map');
                seatMap.innerHTML = '<div class="loading-seats">Loading seat map...</div>';
                
                // Number of seats based on coach type
                const totalSeats = coachType === 'SL' ? 72 : (coachType === '3A' ? 64 : 48);
                
                // In a real application, this would fetch from the backend
                // Simulating API call to get booked seats
                fetchBookedSeats(coachType).then(bookedSeats => {
                    seatMap.innerHTML = '';
                    
                    // Generate seats
                    for(let i = 1; i <= totalSeats; i++) {
                        const seatDiv = document.createElement('div');
                        seatDiv.className = 'seat';
                        
                        // Check if seat is booked
                        const isBooked = bookedSeats.includes(i);
                        if(isBooked) {
                            seatDiv.className += ' booked';
                            seatDiv.title = 'Already Booked';
                        } else {
                            seatDiv.className += ' available';
                            seatDiv.title = 'Available';
                            seatDiv.onclick = function() {
                                if(this.classList.contains('selected')) {
                                    this.classList.remove('selected');
                                } else {
                                    this.classList.add('selected');
                                }
                                updateSelectedSeats();
                            };
                        }
                        
                        seatDiv.textContent = i;
                        seatDiv.dataset.seatNumber = i;
                        seatDiv.dataset.coachType = coachType;
                        seatMap.appendChild(seatDiv);
                    }
                });
                
                // Function to fetch booked seats (simulated)
                function fetchBookedSeats(coachType) {
                    return new Promise(resolve => {
                        // Simulate API delay
                        setTimeout(() => {
                            // In a real app, this would be an API call
                            // For demo, generate some random booked seats
                            const bookedSeats = [];
                            const bookingRate = coachType === 'SL' ? 0.3 : (coachType === '3A' ? 0.4 : 0.5);
                            const totalSeats = coachType === 'SL' ? 72 : (coachType === '3A' ? 64 : 48);
                            
                            for(let i = 1; i <= totalSeats; i++) {
                                if(Math.random() < bookingRate) {
                                    bookedSeats.push(i);
                                }
                            }
                            
                            resolve(bookedSeats);
                        }, 500);
                    });
                }
                
                // Add CSS for seat map
                if(!document.getElementById('seatMapStyles')) {
                    const style = document.createElement('style');
                    style.id = 'seatMapStyles';
                    style.textContent = `
                        .seat {
                            width: 40px;
                            height: 40px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border: 1px solid #ccc;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: bold;
                        }
                        .seat.available {
                            background-color: #e3f2fd;
                            color: #0d47a1;
                        }
                        .seat.booked {
                            background-color: #ffebee;
                            color: #b71c1c;
                            cursor: not-allowed;
                            opacity: 0.7;
                        }
                        .seat.selected {
                            background-color: #4caf50;
                            color: white;
                            border-color: #2e7d32;
                        }
                        
                        /* Mobile responsive styles for seat map */
                        @media (max-width: 768px) {
                            .seat-map {
                                gap: 4px 6px;
                            }
                            .seat {
                                width: 30px;
                                height: 30px;
                                font-size: 12px;
                            }
                            .modal-content {
                                width: 95%;
                                max-width: 95%;
                                padding: 15px;
                            }
                            .coach-select {
                                flex-direction: column;
                                align-items: flex-start;
                            }
                            #coachList {
                                margin-left: 0;
                                margin-top: 5px;
                                width: 100%;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Clear selected seats
                updateSelectedSeats();
            }
            
            // Update selected seats and total price
            function updateSelectedSeats() {
                const selectedSeats = document.querySelectorAll('.seat.selected');
                const seatList = document.querySelector('.seat-list');
                const totalPrice = document.querySelector('.total-price');
                const proceedBtn = document.querySelector('.proceed-payment');
                
                if(selectedSeats.length === 0) {
                    seatList.innerHTML = '<p>No seats selected</p>';
                    totalPrice.textContent = 'â‚¹0';
                    proceedBtn.disabled = true;
                    return;
                }
                
                let seatNumbers = [];
                let price = 0;
                let selectedSeatsData = [];
                
                selectedSeats.forEach(seat => {
                    const coachType = seat.dataset.coachType;
                    const seatNumber = seat.dataset.seatNumber;
                    seatNumbers.push(`${coachType}-${seatNumber}`);
                    
                    // Calculate price based on coach type
                    if(coachType === 'SL') price += 750;
                    else if(coachType === '3A') price += 1500;
                    else if(coachType === '2A') price += 2200;
                    
                    // Store selected seat data
                    selectedSeatsData.push({
                        coach: coachType,
                        seat: seatNumber,
                        price: coachType === 'SL' ? 750 : (coachType === '3A' ? 1500 : 2200)
                    });
                });
                
                // Store selected seats in session storage
                sessionStorage.setItem('selectedSeats', JSON.stringify(selectedSeatsData));
                sessionStorage.setItem('totalPrice', price);
                
                seatList.innerHTML = `<p>Selected Seats: ${seatNumbers.join(', ')}</p>`;
                totalPrice.textContent = `â‚¹${price}`;
                proceedBtn.disabled = false;
            }
            
            // Proceed to payment button
            document.querySelector('.proceed-payment').addEventListener('click', function() {
                const selectedSeats = document.querySelectorAll('.seat.selected');
                
                if(selectedSeats.length === 0) {
                    alert('Please select at least one seat');
                    return;
                }
                
                // Show booking confirmation modal
                document.getElementById('seatSelectionModal').style.display = 'none';
                document.getElementById('confirmationModal').style.display = 'block';
                
                // Update confirmation details
                document.getElementById('bookingId').textContent = 'RAIL' + Math.floor(Math.random() * 1000000);
                document.getElementById('confirmSeats').textContent = Array.from(selectedSeats)
                    .map(seat => `${seat.dataset.coachType}-${seat.dataset.seatNumber}`).join(', ');
                
                // Calculate total price
                let totalPrice = 0;
                selectedSeats.forEach(seat => {
                    const coachType = seat.dataset.coachType;
                    if(coachType === 'SL') totalPrice += 750;
                    else if(coachType === '3A') totalPrice += 1500;
                    else if(coachType === '2A') totalPrice += 2200;
                });
                document.getElementById('confirmAmount').textContent = totalPrice;
            });
            
            // Coach selection change handler
            document.getElementById('coachList').addEventListener('change', generateSeatMap);
            // Modal accessibility: close on ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
                }
            });
            // Login modal tab switching
            document.getElementById('adminTab').onclick = function() {
                this.classList.add('active');
                document.getElementById('passengerTab').classList.remove('active');
                document.getElementById('adminLoginForm').style.display = '';
                document.getElementById('passengerLoginForm').style.display = 'none';
            };
            document.getElementById('passengerTab').onclick = function() {
                this.classList.add('active');
                document.getElementById('adminTab').classList.remove('active');
                document.getElementById('adminLoginForm').style.display = 'none';
                document.getElementById('passengerLoginForm').style.display = '';
            };
            // Registration OTP logic (email-based)
            (function(){
                const sendBtn = document.getElementById('registerSendOTPBtn');
                const resendBtn = document.getElementById('registerResendOTPBtn');
                const verifyBtn = document.getElementById('registerVerifyOTPBtn');
                const otpGroup = document.querySelector('#registerForm .otp-group');
                const otpTimerEl = document.getElementById('registerOtpTimer');
                const passwordGroup = document.getElementById('registerPasswordGroup');
                const confirmPasswordGroup = document.getElementById('registerConfirmPasswordGroup');
                const submitBtn = document.getElementById('registerSubmitBtn');
                let timer = null;
                let timeLeft = 30;
                let lastEmail = '';
                function startTimer(){
                    timeLeft = 30;
                    otpTimerEl.textContent = `(00:${timeLeft.toString().padStart(2,'0')})`;
                    timer = setInterval(()=>{
                        timeLeft -= 1;
                        otpTimerEl.textContent = `(00:${timeLeft.toString().padStart(2,'0')})`;
                        if(timeLeft <= 0){
                            clearInterval(timer);
                            resendBtn.style.display = '';
                            verifyBtn.style.display = 'none';
                            otpTimerEl.textContent = '(expired)';
                        }
                    },1000);
                }
                function stopTimer(){ if(timer) clearInterval(timer); timer = null; }

                async function sendOTP(){
                    const email = document.getElementById('registerEmail').value.trim();
                    if(!email.match(/^\S+@\S+\.\S+$/)){
                        alert('Enter a valid email address');
                        return;
                    }
                    sendBtn.disabled = true;
                    sendBtn.textContent = 'Sending...';
                    console.log('[OTP] Sending OTP to:', email);
                    try {
                        const res = await fetch('/api/passenger/send_otp', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ email })
                        });
                        if(res.ok){
                            otpGroup.style.display = '';
                            sendBtn.style.display = 'none';
                            resendBtn.style.display = 'none';
                            verifyBtn.style.display = '';
                            startTimer();
                            lastEmail = email;
                            alert('OTP sent to your email. Please check your inbox (and spam folder).');
                            console.log('[OTP] OTP sent successfully to:', email);
                        }else{
                            const data = await res.json().catch(()=>({message:'Failed to send OTP'}));
                            alert(data.message || 'Failed to send OTP');
                            console.error('[OTP] Failed to send OTP:', data.message);
                        }
                    } catch (err) {
                        alert('Error sending OTP.');
                        console.error('[OTP] Error sending OTP:', err);
                    } finally {
                        sendBtn.disabled = false;
                        sendBtn.textContent = 'Send OTP';
                    }
                }

                async function resendOTP(){
                    if(!lastEmail){ alert('Please enter email and send OTP first.'); return; }
                    resendBtn.disabled = true;
                    resendBtn.textContent = 'Resending...';
                    try {
                        const res = await fetch('/api/passenger/send_otp', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ email: lastEmail })
                        });
                        if(res.ok){
                            otpGroup.style.display = '';
                            resendBtn.style.display = 'none';
                            verifyBtn.style.display = '';
                            startTimer();
                            alert('OTP resent to your email.');
                        }else{
                            const data = await res.json().catch(()=>({message:'Failed to resend OTP'}));
                            alert(data.message || 'Failed to resend OTP');
                        }
                    } finally {
                        resendBtn.disabled = false;
                        resendBtn.textContent = 'Resend OTP';
                    }
                }

                async function verifyOTP(){
                    const otp = document.getElementById('registerOTP').value.trim();
                    if(!lastEmail){ alert('Please send OTP first.'); return; }
                    if(!otp){ alert('Enter the OTP'); return; }
                    verifyBtn.disabled = true;
                    verifyBtn.textContent = 'Verifying...';
                    console.log('[OTP] Verifying OTP for:', lastEmail, 'OTP:', otp);
                    try {
                        const res = await fetch('/api/passenger/verify_otp', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ email: lastEmail, otp })
                        });
                        if(res.ok){
                            stopTimer();
                            passwordGroup.style.display = '';
                            confirmPasswordGroup.style.display = '';
                            submitBtn.style.display = '';
                            verifyBtn.style.display = 'none';
                            alert('OTP verified. Please set your password.');
                            console.log('[OTP] OTP verified for:', lastEmail);
                        }else{
                            const data = await res.json().catch(()=>({message:'Invalid OTP'}));
                            alert(data.message || 'Invalid OTP');
                            console.error('[OTP] Invalid OTP:', data.message);
                        }
                    } catch (err) {
                        alert('Error verifying OTP.');
                        console.error('[OTP] Error verifying OTP:', err);
                    } finally {
                        verifyBtn.disabled = false;
                        verifyBtn.textContent = 'Verify OTP';
                    }
                }

                sendBtn.addEventListener('click', sendOTP);
                resendBtn.addEventListener('click', resendOTP);
                verifyBtn.addEventListener('click', verifyOTP);

                document.getElementById('registerForm').addEventListener('submit', async function(e){
                    e.preventDefault();
                    // Only allow submit after OTP verified
                    if(submitBtn.style.display === 'none') return;
                    const name = document.getElementById('name').value.trim();
                    const email = document.getElementById('registerEmail').value.trim();
                    const password = document.getElementById('registerPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    if(!name || !email || !password || !confirmPassword){
                        alert('Please fill all fields');
                        return;
                    }
                    if(password !== confirmPassword){
                        alert('Passwords do not match');
                        return;
                    }
                    // Register user
                    const res = await fetch('/api/users/register', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ name, email, password })
                    });
                    if(res.ok){
                        alert('Registration successful! You can now log in.');
                        document.getElementById('registerModal').style.display = 'none';
                    }else{
                        const data = await res.json().catch(()=>({message:'Registration failed'}));
                        alert(data.message || 'Registration failed');
                    }
                });
            })();

            // Train Tracking Functionality
            document.addEventListener('DOMContentLoaded', function() {
                const trackingForm = document.getElementById('trackingForm');
                const trackingResults = document.getElementById('trackingResults');
                
                if (trackingForm) {
                    trackingForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const trainNumber = document.getElementById('trainNumber').value.trim();
                        
                        if (!trainNumber) {
                            alert('Please enter a train number or name');
                            return;
                        }
                        
                        // Show loading
                        trackingResults.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading train information...</div>';
                        trackingResults.style.display = 'block';
                        
                        // Fetch train data from API
                        fetch(`/api/trains/track?query=${encodeURIComponent(trainNumber)}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    trackingResults.innerHTML = `<div class="error-message">${data.error}</div>`;
                                    return;
                                }
                                
                                // Display train information with actual data
                                const train = data.train;
                                const html = `
                                    <div class="train-status-card">
                                        <h3>${train.name} (${train.number})</h3>
                                        <div class="status-badge ${train.status.toLowerCase()}">${train.status}</div>
                                        <div class="train-details-row">
                                            <div class="detail-item">
                                                <span class="detail-label">From:</span>
                                                <span class="detail-value">${train.from}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">To:</span>
                                                <span class="detail-value">${train.to}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Duration:</span>
                                                <span class="detail-value">${train.duration}</span>
                                            </div>
                                        </div>
                                        <div class="train-details-row">
                                            <div class="detail-item">
                                                <span class="detail-label">Distance:</span>
                                                <span class="detail-value">${train.distance} km</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Current Station:</span>
                                                <span class="detail-value">${train.current_station || 'N/A'}</span>
                                            </div>
                                        </div>
                                        <div class="route-timeline">
                                            <h4>Route Information</h4>
                                            <div class="timeline">
                                                ${train.route.map((station, index) => `
                                                    <div class="timeline-item ${station.status}">
                                                        <div class="timeline-marker"></div>
                                                        <div class="timeline-content">
                                                            <h5>${station.name}</h5>
                                                            <p>${station.arrival} - ${station.departure}</p>
                                                            ${station.status === 'current' ? '<span class="current-station-badge">Current Location</span>' : ''}
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                `;
                                trackingResults.innerHTML = html;
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                // Fallback for demo - show static data with correct duration and distance
                                const html = `
                                    <div class="train-status-card">
                                        <h3>Rajdhani Express (12301)</h3>
                                        <div class="status-badge running">Running</div>
                                        <div class="train-details-row">
                                            <div class="detail-item">
                                                <span class="detail-label">From:</span>
                                                <span class="detail-value">Delhi</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">To:</span>
                                                <span class="detail-value">Mumbai</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Duration:</span>
                                                <span class="detail-value">16h 30m</span>
                                            </div>
                                        </div>
                                        <div class="train-details-row">
                                            <div class="detail-item">
                                                <span class="detail-label">Distance:</span>
                                                <span class="detail-value">1,384 km</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Current Station:</span>
                                                <span class="detail-value">Kota Junction</span>
                                            </div>
                                        </div>
                                        <div class="route-timeline">
                                            <h4>Route Information</h4>
                                            <div class="timeline">
                                                <div class="timeline-item passed">
                                                    <div class="timeline-marker"></div>
                                                    <div class="timeline-content">
                                                        <h5>Delhi</h5>
                                                        <p>07:00 - 07:20</p>
                                                    </div>
                                                </div>
                                                <div class="timeline-item passed">
                                                    <div class="timeline-marker"></div>
                                                    <div class="timeline-content">
                                                        <h5>Mathura Junction</h5>
                                                        <p>09:15 - 09:20</p>
                                                    </div>
                                                </div>
                                                <div class="timeline-item current">
                                                    <div class="timeline-marker"></div>
                                                    <div class="timeline-content">
                                                        <h5>Kota Junction</h5>
                                                        <p>12:30 - 12:40</p>
                                                        <span class="current-station-badge">Current Location</span>
                                                    </div>
                                                </div>
                                                <div class="timeline-item upcoming">
                                                    <div class="timeline-marker"></div>
                                                    <div class="timeline-content">
                                                        <h5>Ratlam Junction</h5>
                                                        <p>15:45 - 15:50</p>
                                                    </div>
                                                </div>
                                                <div class="timeline-item upcoming">
                                                    <div class="timeline-marker"></div>
                                                    <div class="timeline-content">
                                                        <h5>Mumbai</h5>
                                                        <p>23:30 - End</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                trackingResults.innerHTML = html;
                            });
                            
                        // Scroll to results
                        trackingResults.scrollIntoView({ behavior: 'smooth' });
                    });
                }
            });
            
            // Booking form live data (main and modal forms)
            function bindLivePreview(srcId, destId, dateId, targetPrefix){
                const s = document.getElementById(srcId);
                const d = document.getElementById(destId);
                const dt = document.getElementById(dateId);
                if(s) s.addEventListener('input', ()=>{ const el = document.getElementById(targetPrefix+'Source'); if(el) el.textContent = s.value || '-'; });
                if(d) d.addEventListener('input', ()=>{ const el = document.getElementById(targetPrefix+'Destination'); if(el) el.textContent = d.value || '-'; });
                if(dt) dt.addEventListener('input', ()=>{ const el = document.getElementById(targetPrefix+'Date'); if(el) el.textContent = dt.value || '-'; });
            }
            bindLivePreview('source','destination','date','entered');
            bindLivePreview('sourceModal','destinationModal','dateModal','enteredModal');

            // --- Train search and booking logic ---
            function getTrains(){
                return JSON.parse(localStorage.getItem('trains')||'[]');
            }
            function getBookings(){
                return JSON.parse(localStorage.getItem('bookings')||'[]');
            }
            function setBookings(bookings){
                localStorage.setItem('bookings',JSON.stringify(bookings));
            }
            // Booking search (filter trains by from, to, date using backend API)
            document.getElementById('trainSearchForm').onsubmit = async function(e){
                e.preventDefault();
                const from = document.getElementById('source').value.trim();
                const to = document.getElementById('destination').value.trim();
                const date = document.getElementById('date').value;
                const trainList = document.getElementById('trainList');
                if(!from || !to || !date){
                    trainList.innerHTML = '<div class="no-trains">Please enter all fields</div>';
                    return;
                }
                trainList.innerHTML = '<div class="no-trains">Searching...</div>';
                try {
                    const res = await fetch(`/api/trains`);
                    const data = await res.json();
                    let trains = (data.trains || []).filter(t =>
                        (t.source||t.from||'').toLowerCase() === from.toLowerCase() &&
                        (t.destination||t.to||'').toLowerCase() === to.toLowerCase()
                    );
                    if(trains.length){
                        trainList.innerHTML = trains.map(t=>`<div class="train-item"><b>${t.name}</b> | Departure: ${t.departure_time||t.departure} <button class='btn btn-sm btn-primary' onclick='bookTrain("${t._id}","${t.name}","${t.source||t.from}","${t.destination||t.to}","${date}")'>Book</button></div>`).join('');
                    }else{
                        trainList.innerHTML = '<div class="no-trains">No trains found for this route and date</div>';
                    }
                } catch(err){
                    trainList.innerHTML = '<div class="no-trains">Error fetching trains</div>';
                }
            }
            // Book train with proper flow
            window.bookTrain = function(name,from,to,date){
                // Check if user is logged in as passenger
                if(sessionStorage.getItem('role') !== 'passenger') {
                    // Show login modal if not logged in
                    document.getElementById('loginModal').style.display = 'block';
                    // Switch to passenger tab
                    document.getElementById('passengerTab').click();
                    // Store booking details for after login
                    sessionStorage.setItem('pendingBooking', JSON.stringify({train:name,from,to,date}));
                    return;
                }
                
                // User is logged in, proceed to seat selection
                // Store train details for seat selection
                sessionStorage.setItem('currentBooking', JSON.stringify({train:name,from,to,date}));
                
                // Show seat selection modal
                document.getElementById('seatModal').style.display = 'block';
                
                // Load available coaches based on class
                loadCoachesForClass(name);
                
                // Load seat availability
                loadSeatAvailability();
            }
            
            // Function to load coaches based on class
            function loadCoachesForClass(trainName) {
                const coachSelect = document.getElementById('coachSelect');
                coachSelect.innerHTML = ''; // Clear existing options
                
                // Get train class from train name (demo logic - in real app would come from API)
                const isAC = trainName.toLowerCase().includes('rajdhani') || trainName.toLowerCase().includes('shatabdi');
                
                // Add appropriate coaches based on class
                if (isAC) {
                    // AC coaches
                    coachSelect.innerHTML += '<option value="A1">A1 - AC First Class</option>';
                    coachSelect.innerHTML += '<option value="A2">A2 - AC First Class</option>';
                    coachSelect.innerHTML += '<option value="B1">B1 - AC 2 Tier</option>';
                    coachSelect.innerHTML += '<option value="B2">B2 - AC 2 Tier</option>';
                } else {
                    // Sleeper coaches
                    coachSelect.innerHTML += '<option value="S1">S1 - Sleeper</option>';
                    coachSelect.innerHTML += '<option value="S2">S2 - Sleeper</option>';
                    coachSelect.innerHTML += '<option value="S3">S3 - Sleeper</option>';
                    coachSelect.innerHTML += '<option value="S4">S4 - Sleeper</option>';
                }
                
                // Add event listener to coach select to reload seats when coach changes
                coachSelect.addEventListener('change', loadSeatAvailability);
            }
            
            // Function to load seat availability
            function loadSeatAvailability() {
                // Get selected coach
                const coach = document.getElementById('coachSelect').value;
                
                // In a real app, this would be an API call to get booked seats
                // For demo, we'll randomly mark some seats as booked
                fetchBookedSeats(coach).then(bookedSeats => {
                    // Update the seat map with booked seats
                    updateSeatMap(coach, bookedSeats);
                });
            }
            
            // Function to fetch booked seats (simulated API call)
            async function fetchBookedSeats(coach) {
                // Show loading state
                const seatContainer = document.querySelector('.seat-container');
                if (seatContainer) {
                    seatContainer.innerHTML = '<div class="loading-seats">Loading seat availability...</div>';
                }
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Generate random booked seats (in real app, this would be an API call)
                const totalSeats = coach.startsWith('A') ? 18 : 72; // AC has fewer seats than sleeper
                const bookedSeats = [];
                
                // Randomly mark about 30% of seats as booked
                for (let i = 1; i <= totalSeats; i++) {
                    if (Math.random() < 0.3) {
                        bookedSeats.push(i);
                    }
                }
                
                return bookedSeats;
            }
            
            // Function to update the seat map with booked seats
            function updateSeatMap(coach, bookedSeats) {
                const seatContainer = document.querySelector('.seat-container');
                if (!seatContainer) return;
                
                // Clear existing seats
                seatContainer.innerHTML = '';
                
                // Create seat layout based on coach type
                const isAC = coach.startsWith('A');
                const rows = isAC ? 6 : 9;
                const seatsPerRow = isAC ? 3 : 8;
                
                // Create seat map
                let seatHtml = '<div class="coach-layout">';
                let seatNumber = 1;
                
                for (let row = 1; row <= rows; row++) {
                    seatHtml += '<div class="seat-row">';
                    
                    for (let seat = 1; seat <= seatsPerRow; seat++) {
                        const isBooked = bookedSeats.includes(seatNumber);
                        const seatClass = isBooked ? 'seat booked' : 'seat available';
                        const disabled = isBooked ? 'disabled' : '';
                        
                        seatHtml += `<div class="${seatClass}" data-seat="${seatNumber}" ${disabled}>
                            <span class="seat-number">${seatNumber}</span>
                        </div>`;
                        
                        seatNumber++;
                    }
                    
                    seatHtml += '</div>';
                }
                
                seatHtml += '</div>';
                seatHtml += '<div class="seat-legend">'+
                    '<div class="legend-item"><div class="seat-sample available"></div> Available</div>'+
                    '<div class="legend-item"><div class="seat-sample booked"></div> Booked</div>'+
                    '<div class="legend-item"><div class="seat-sample selected"></div> Selected</div>'+
                '</div>';
                
                // Add continue button
                seatHtml += '<div class="seat-actions">'+
                    '<button id="continueToPayment" class="btn btn-primary" disabled>Continue to Payment</button>'+
                '</div>';
                
                seatContainer.innerHTML = seatHtml;
                
                // Add event listeners to seats
                document.querySelectorAll('.seat.available').forEach(seat => {
                    seat.addEventListener('click', function() {
                        this.classList.toggle('selected');
                        updateSelectedSeats();
                    });
                });
                
                // Add event listener to continue button
                document.getElementById('continueToPayment').addEventListener('click', function() {
                    const selectedSeats = Array.from(document.querySelectorAll('.seat.selected')).map(seat => seat.dataset.seat);
                    if (selectedSeats.length === 0) {
                        alert('Please select at least one seat to continue.');
                        return;
                    }
                    
                    // Store selected seats in session storage
                    const booking = JSON.parse(sessionStorage.getItem('currentBooking') || '{}');
                    booking.seats = selectedSeats;
                    booking.coach = document.getElementById('coachSelect').value;
                    sessionStorage.setItem('currentBooking', JSON.stringify(booking));
                    
                    // Close seat modal
                    document.getElementById('seatModal').style.display = 'none';
                    
                    // Redirect to payment page
                    window.location.href = 'payment.html';
                });
            }
            
            // Function to update selected seats information
            function updateSelectedSeats() {
                const selectedSeats = document.querySelectorAll('.seat.selected');
                const continueBtn = document.getElementById('continueToPayment');
                
                // Enable/disable continue button based on selection
                continueBtn.disabled = selectedSeats.length === 0;
                
                // Update selected seats count and price (if needed)
                // This could be expanded to show total price, etc.
            }
            // Tracking logic
            // Train tracking by train number (uses backend API)
            document.getElementById('trackingForm').onsubmit = async function(e){
                e.preventDefault();
                const trainNumber = document.getElementById('trainNumber').value.trim();
                const info = document.getElementById('trackingInfo');
                if(!trainNumber){
                    info.innerHTML = '<div class="no-tracking">Enter train number</div>';
                    return;
                }
                info.innerHTML = '<div class="no-tracking">Searching...</div>';
                try {
                    // Find train by number
                    const res = await fetch('/api/trains');
                    const data = await res.json();
                    const trains = data.trains || [];
                    const t = trains.find(t=>t.name===trainNumber || t._id===trainNumber);
                    if(t){
                        // Optionally, fetch tracking info from backend if available
                        info.innerHTML = `<div class='train-info'><b>${t.name}</b><br>From: ${t.source||t.from}<br>To: ${t.destination||t.to}<br>Departure: ${t.departure_time||t.departure}</div>`;
                    }else{
                        info.innerHTML = '<div class="no-tracking">Train not found</div>';
                    }
                } catch(err){
                    info.innerHTML = '<div class="no-tracking">Error fetching train info</div>';
                }
            }



            // Highlight nav link according to scroll position
            const navLinksArr = document.querySelectorAll('.nav-links a');
            const sections = document.querySelectorAll('section');
            function updateActiveNav() {
                let index = 0;
                const midpoint = window.scrollY + window.innerHeight / 3;
                sections.forEach((sec, i) => {
                    if (sec.offsetTop < midpoint) index = i;
                });
                navLinksArr.forEach(a => a.classList.remove('active'));
                const target = sections[index].id;
                const link = Array.from(navLinksArr).find(a => a.getAttribute('href') === `#${target}` || (target === '' && a.getAttribute('href') === '/'));
                if (link) link.classList.add('active');
            }
            window.addEventListener('scroll', updateActiveNav);
            updateActiveNav();

            // Open login modal when /login.html is requested client-side
            document.querySelectorAll('.nav-links a').forEach(a => {
                if (a.getAttribute('href') === '/login.html') {
                    a.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.getElementById('loginModal').style.display = 'block';
                        // focus first input for accessibility
                        setTimeout(()=>{
                            const input = document.querySelector('#loginModal input');
                            if(input) input.focus();
                        },120);
                    });
                }
            });

            // Admin demo login (client-side check for demo)
            document.getElementById('adminLoginForm').addEventListener('submit', function(e){
                e.preventDefault();
                const email = document.getElementById('adminEmail').value.trim();
                const pwd = document.getElementById('adminPassword').value;
                if(email === 'admin@example.com' && pwd === 'Admin@123'){
                    // mark session as admin for demo flows
                    sessionStorage.setItem('role','admin');
                    alert('Admin logged in (demo)');
                    document.getElementById('loginModal').style.display = 'none';
                    // redirect to static admin page for Vercel
                    window.location.href = '/static/admin.html';
                } else {
                    alert('Invalid admin credentials (demo)');
                }
            });

            // Modal close handlers
            document.querySelectorAll('.modal .close').forEach(btn => btn.addEventListener('click', function(){
                this.closest('.modal').style.display = 'none';
            }));
            </script>
</body>
</html>