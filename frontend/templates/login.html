<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | RailConnect</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="header-container container">
            <div class="logo">
                <h1><i class="fas fa-train"></i> RailConnect</h1>
            </div>
            <ul class="nav-links">
                <li><a href="/" >Home</a></li>
                <li><a href="/index.html#booking">Book Tickets</a></li>
                <li><a href="/index.html#tracking">Track Train</a></li>
                <li><a href="/index.html#alerts">Alerts</a></li>
                <li><a href="/login.html" class="active">Login</a></li>
            </ul>
        </div>
    </header>
    <main style="min-height: 80vh; display: flex; align-items: center; justify-content: center;">
        <div class="modal-content" style="max-width: 420px; width: 100%; margin: 60px auto;">
            <h2 style="text-align:center;">Login</h2>
            <div class="login-tabs">
                <button class="tab-btn active" id="adminTab">Admin</button>
                <button class="tab-btn" id="passengerTab">Passenger</button>
            </div>
            <form id="adminLoginForm" class="login-form">
                <div class="form-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" placeholder="Enter admin email" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary">Login as Admin</button>
            </form>
            <form id="passengerLoginForm" class="login-form" style="display:none;">
                <div class="form-group">
                    <label for="passengerEmail">Email Address</label>
                    <input type="email" id="passengerEmail" placeholder="Enter email address" required>
                </div>
                <div class="form-group otp-group" style="display:none;">
                    <label for="passengerOTP">OTP</label>
                    <input type="text" id="passengerOTP" placeholder="Enter OTP" maxlength="6">
                </div>
                <button type="button" class="btn btn-primary" id="sendOTPBtn">Send OTP</button>
                <button type="submit" class="btn btn-primary" id="verifyOTPBtn" style="display:none;">Verify OTP</button>
            </form>
            <p style="text-align:center; margin-top: 15px;">Don't have an account? <a href="#" id="registerLink">Register</a></p>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2><i class="fas fa-train"></i> RailConnect</h2>
                    <p>Your trusted railway reservation and tracking platform</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 RailConnect. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="../static/js/main.js"></script>
    <script>
    // Tab switching for login page
    document.getElementById('adminTab').onclick = function() {
        this.classList.add('active');
        document.getElementById('passengerTab').classList.remove('active');
        document.getElementById('adminLoginForm').style.display = '';
        document.getElementById('passengerLoginForm').style.display = 'none';
    };
    
    document.getElementById('passengerTab').onclick = function() {
        this.classList.add('active');
        document.getElementById('adminTab').classList.remove('active');
        document.getElementById('adminLoginForm').style.display = 'none';
        document.getElementById('passengerLoginForm').style.display = '';
    };
    
    // OTP functionality for passenger login
    document.getElementById('sendOTPBtn').onclick = function() {
        const email = document.getElementById('passengerEmail').value;
        if(!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            alert('Please enter a valid email address');
            return;
        }
        
        // Make API call to send OTP
        fetch('/api/passenger/send_otp', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                // For demo purposes, store mock OTP in session
                sessionStorage.setItem('mock_otp', '123456');
                alert('OTP sent to ' + email + ' (For testing, use: 123456)');
                document.querySelector('.otp-group').style.display = '';
                this.style.display = 'none';
                document.getElementById('verifyOTPBtn').style.display = '';
            } else {
                alert('Failed to send OTP. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Fallback for demo
            sessionStorage.setItem('mock_otp', '123456');
            alert('OTP sent to ' + email + ' (For testing, use: 123456)');
            document.querySelector('.otp-group').style.display = '';
            this.style.display = 'none';
            document.getElementById('verifyOTPBtn').style.display = '';
        });
    };
    
    // simple timer/resend behavior (optional)
    (function(){
        const otpTimerEl = document.querySelector('.otp-group small') || null;
        let t = null; let left = 30;
        function start(){ left=30; if(otpTimerEl) otpTimerEl.textContent=`(00:${String(left).padStart(2,'0')})`; t=setInterval(()=>{ left--; if(otpTimerEl) otpTimerEl.textContent=`(00:${String(left).padStart(2,'0')})`; if(left<=0){ clearInterval(t); } },1000); }
        document.getElementById('sendOTPBtn').addEventListener('click', start);
    })();
    
    // Admin login functionality
    document.getElementById('adminLoginForm').onsubmit = function(e) {
        e.preventDefault();
        const email = document.getElementById('adminEmail').value;
        const password = document.getElementById('adminPassword').value;
        
        // Simple validation
        if(!email || !password) {
            alert('Please enter both email and password');
            return;
        }
        
        // For demo purposes check demo credentials
        if(email === 'admin@example.com' && password === 'Admin@123'){
            sessionStorage.setItem('role','admin');
            alert('Admin logged in (demo)');
            window.location.href = '/static/admin.html';
            return;
        }
        alert('Invalid admin credentials (demo)');
    };
    
    // Passenger login with OTP verification
    document.getElementById('verifyOTPBtn').onclick = function(e) {
        e.preventDefault();
        const otp = document.getElementById('passengerOTP').value;
        
        if(!otp || otp.length !== 6 || !/^\d+$/.test(otp)) {
            alert('Please enter a valid 6-digit OTP');
            return;
        }
        
        // Verify OTP against stored mock OTP
        const mockOtp = sessionStorage.getItem('mock_otp') || '123456';
        if(otp !== mockOtp) {
            alert('Invalid OTP. Please try again.');
            return;
        }
        // mark session as passenger
        sessionStorage.setItem('role','passenger');
        alert('Passenger logged in (demo)');
    window.location.href = '/index.html';
    };
    </script>
</body>
</html>
